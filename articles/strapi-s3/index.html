<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>Strapi - Подключение S3 хранилища для файлов</title>
<meta name=description content="Lead developer"><meta name=keywords content='ладыгин сергей,Strapi'><meta property="og:url" content="https://updev.ru/articles/strapi-s3/"><meta property="og:type" content="website"><meta property="og:title" content="Strapi - Подключение S3 хранилища для файлов"><meta property="og:description" content="Lead developer"><meta property="og:image" content="/articles/strapi-s3/cover.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Strapi - Подключение S3 хранилища для файлов"><meta name=twitter:description content="Lead developer"><meta property="twitter:domain" content="https://updev.ru/articles/strapi-s3/"><meta property="twitter:url" content="https://updev.ru/articles/strapi-s3/"><meta name=twitter:image content="/articles/strapi-s3/cover.png"><link rel=canonical href=https://updev.ru/articles/strapi-s3/><link rel=stylesheet type=text/css href=https://updev.ru//css/normalize.min.css media=print onload='this.media="all"'><link rel=stylesheet type=text/css href=https://updev.ru//css/main.css><link disabled id=dark-theme rel=stylesheet href=https://updev.ru//css/dark.css><script src=https://updev.ru//js/svg-injector.min.js></script><script src=https://updev.ru//js/feather-icons.min.js></script><script src=https://updev.ru//js/main.js></script><link rel=stylesheet type=text/css href=/css/base.css><script type=text/javascript>(function(e,t,n,s,o,i,a){e[o]=e[o]||function(){(e[o].a=e[o].a||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://mc.yandex.ru/metrika/tag.js","ym"),ym(89940266,"init",{clickmap:!0,trackLinks:!0,accurateTrackBounce:!0})</script><noscript><div><img src=https://mc.yandex.ru/watch/89940266 style=position:absolute;left:-9999px alt></div></noscript></head><body><script type=text/javascript>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://updev.ru/><img src=https://updev.ru//images/avatar.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://updev.ru/>Ладыгин Сергей</a></div><div class=nav-links><div class=nav-link><a href=https://updev.ru/projects/>Проекты</a></div><div class=nav-link><a href=https://updev.ru/articles/>Статьи</a></div><div class=nav-link><a href=https://updev.ru/radar/>Тех. радар</a></div><div class=nav-link><a href=https://github.com/updevru><span data-feather=github></span></a></div><div class=nav-link><a href=https://t.me/updevru><span data-feather=send></span></a></div><div class=nav-link><a href=https://updev.ru/index.xml><span data-feather=rss></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><a><span id=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><a><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://updev.ru/projects/>Проекты</a></li><li class=nav-item><a href=https://updev.ru/articles/>Статьи</a></li><li class=nav-item><a href=https://updev.ru/radar/>Тех. радар</a></li><li class=nav-item><a href=https://github.com/updevru><span data-feather=github></span></a></li><li class=nav-item><a href=https://t.me/updevru><span data-feather=send></span></a></li><li class=nav-item><a href=https://updev.ru/index.xml><span data-feather=rss></span></a></li><li class="nav-item dark-theme-toggle"><a><span id=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content class=page-type-post><div class="post container"><div class=post-header-section><h1>Strapi - Подключение S3 хранилища для файлов</h1><small role=doc-subtitle></small><p class=post-date>мая 6, 2024</p><ul class=post-tags><li class=post-tag><a href=https://updev.ru/tags/strapi>Strapi</a></li></ul></div><div class=post-content><p><p><img src=cover.png alt></p><p>Для хранения загружаемых файлов будем использовать S3 хранилище - Yandex Object Storage.
В нем можно дешево хранить файлы и быстро раздавать их через cdn.</p><p>Инструкция по <a href=https://yandex.cloud/ru/docs/storage/operations/buckets/create>созданию бакета</a>
и настройке <a href=https://yandex.cloud/ru/docs/storage/operations/buckets/bucket-availability>публичного доступа</a>.</p><p>Устанавливаем в strapi плагин для работы с S3 хранилищем.</p><pre tabindex=0><code>npm install @strapi/provider-upload-aws-s3 --save
</code></pre><p>Добавить конфигурацию для подключения к S3 Yandex cloud</p><pre tabindex=0><code>module.exports = ({ env }) =&gt; ({
  upload: {
    config: {
      provider: &#39;aws-s3&#39;,
      providerOptions: {
        credentials: {
          accessKeyId: env(&#39;YC_ACCESS_KEY_ID&#39;),
          secretAccessKey: env(&#39;YC_ACCESS_SECRET&#39;),
        },
        region: &#39;ru-central1&#39;,
        endpoint: &#39;https://storage.yandexcloud.net&#39;,
        params: {
          Bucket: env(&#39;YC_BUCKET&#39;),
        },
      },
    },
  },
});
</code></pre><p>Для отображения в галерее превью картинок необходимо добавить домен в доверенный.</p><pre tabindex=0><code>{
    name: &#39;strapi::security&#39;,
    config: {
      contentSecurityPolicy: {
        useDefaults: true,
        directives: {
          &#39;connect-src&#39;: [&#34;&#39;self&#39;&#34;, &#39;https:&#39;],
          &#39;img-src&#39;: [
            &#34;&#39;self&#39;&#34;,
            &#39;data:&#39;,
            &#39;blob:&#39;,
            &#39;market-assets.strapi.io&#39;,
            &#39;https://&#39;+env(&#39;YC_BUCKET&#39;)+&#39;.storage.yandexcloud.net&#39;,
          ],
          &#39;media-src&#39;: [
            &#34;&#39;self&#39;&#34;,
            &#39;data:&#39;,
            &#39;blob:&#39;,
            &#39;market-assets.strapi.io&#39;,
            &#39;https://&#39;+env(&#39;YC_BUCKET&#39;)+&#39;.storage.yandexcloud.net&#39;,
          ],
          upgradeInsecureRequests: null,
        },
      },
    },
  },
</code></pre><p>Создаем ключ и секрет для загрузки файлов в бакет.</p><ol><li><a href=https://yandex.cloud/ru/docs/iam/operations/sa/create>Создайте сервисный аккаунт</a>.</li><li>Назначьте сервисному аккаунту роль <code>storage.uploader</code></li><li><a href=https://yandex.cloud/ru/docs/iam/operations/sa/create-access-key>Создайте статический ключ доступа</a>.</li></ol><p>Добавляем новые переменные окружения.</p><ul><li><code>YC_BUCKET</code> - название бакета</li><li><code>YC_ACCESS_KEY_ID</code> - идентификатор ключа</li><li><code>YC_ACCESS_SECRET</code> - секретный ключ</li></ul><p>Исходный код руководства на <a href=https://github.com/updevru/tutorial-strapi-deploy>GitHub</a>.</p></p></div></div><aside class=post-toc><nav id=toc><nav id=TableOfContents></nav></nav></aside></main><footer class=footer><span>&copy; 2025 Ладыгин Сергей</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/526avijitgupta/gokarna>Gokarna</a></span></footer></body></html>